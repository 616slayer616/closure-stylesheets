<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ColorUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">closure-stylesheets</a> &gt; <a href="index.source.html" class="el_package">com.google.common.css.compiler.gssfunctions</a> &gt; <span class="el_source">ColorUtil.java</span></div><h1>ColorUtil.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2010 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.google.common.css.compiler.gssfunctions;

import java.awt.*;

/**
 * Utility functions to deal with colors.
 *
 * @author dgajda@google.com (Damian Gajda)
 */
class ColorUtil {

    /**
     * Index of Hue in HSB and HSL array.
     */
    static final int H = 0;
    /**
     * Index of Saturation in HSB and HSL array.
     */
    static final int S = 1;
    /**
     * Index of Brightness in HSB array.
     */
    static final int B = 2;
    /**
     * Index of Lightness in HSL array.
     */
    static final int L = 2;

    static float[] toHsb(Color color) {
<span class="fc" id="L46">        return Color.RGBtoHSB(</span>
<span class="fc" id="L47">                color.getRed(), color.getGreen(), color.getBlue(), null);</span>
    }

    static String formatColor(Color color) {
<span class="fc" id="L51">        return String.format(&quot;#%02X%02X%02X&quot;,</span>
<span class="fc" id="L52">                color.getRed(), color.getGreen(), color.getBlue());</span>
    }

    static Color hsbToColor(float[] inputHsb) {
<span class="nc" id="L56">        return Color.getHSBColor(inputHsb[H], inputHsb[S], inputHsb[B]);</span>
    }

    /**
     * Convert a color in HSB color space to one in HSL color space.
     *
     * @param inputHsb HSB color in a array of three floats, 0 is Hue, 1 is
     *                 Saturation and 2 is Brightness
     * @return HSL color in array of three floats, 0 is Hue, 1 is
     * Saturation and 2 is Lightness
     */
    static float[] hsbToHsl(float[] inputHsb) {
<span class="fc" id="L68">        float hHsb = inputHsb[H];</span>
<span class="fc" id="L69">        float sHsb = inputHsb[S];</span>
<span class="fc" id="L70">        float bHsb = inputHsb[B];</span>

<span class="fc" id="L72">        float hHsl = hHsb;</span>
<span class="fc" id="L73">        float lHsl = bHsb * (2 - sHsb) / 2;</span>
<span class="fc" id="L74">        float sHsl = bHsb * sHsb / (1 - Math.abs(2 * lHsl - 1));</span>

<span class="fc" id="L76">        float[] hsl = {hHsl, sHsl, lHsl};</span>

<span class="fc" id="L78">        return hsl;</span>
    }

    /**
     * Get the HSL values of a color.
     *
     * @param color Color to get the HSL values
     * @return array of floats representing the color in HSL color space
     */
    static float[] toHsl(Color color) {
<span class="fc" id="L88">        return hsbToHsl(toHsb(color));</span>
    }

    /**
     * Convert a color in HSL color space to one in HSB color space.
     *
     * @param inputHsl HSL color in a array of three floats, 0 is Hue, 1 is
     *                 Saturation and 2 is Lightness
     * @return HSB color in array of three floats, 0 is Hue, 1 is
     * Saturation and 2 is Brightness
     */
    static float[] hslToHsb(float[] inputHsl) {
<span class="fc" id="L100">        float hHsl = inputHsl[H];</span>
<span class="fc" id="L101">        float sHsl = inputHsl[S];</span>
<span class="fc" id="L102">        float lHsl = inputHsl[L];</span>

<span class="fc" id="L104">        float hHsb = hHsl;</span>
<span class="fc" id="L105">        float bHsb = (2 * lHsl + sHsl * (1 - Math.abs(2 * lHsl - 1))) / 2;</span>
<span class="fc" id="L106">        float sHsb = 2 * (bHsb - lHsl) / bHsb;</span>

<span class="fc" id="L108">        float[] hsb = {hHsb, sHsb, bHsb};</span>

<span class="fc" id="L110">        return hsb;</span>
    }

    /**
     * Get the color from the HSL floats
     *
     * @param inputHsl HSL color
     * @return Java color
     */
    static Color hslToColor(float[] inputHsl) {
<span class="fc" id="L120">        float[] hsb = hslToHsb(inputHsl);</span>

<span class="fc" id="L122">        return Color.getHSBColor(hsb[H], hsb[S], hsb[B]);</span>
    }

    /**
     * Tests whether the given colors are contrasting colors, according to the
     * test described in the W3C accessibility evaluation working draft
     * {@link &quot;http://www.w3.org/TR/AERT#color-contrast&quot;}.  This is a lenient
     * version of the test which allows the user to pass in the accepted leniency
     * margin.
     *
     * &lt;p&gt;The value of the leniency margin is in the range 0 to 1.0.  0 means
     * that the test is not lenient at all, 1.0 means that the test will pass for
     * all colors that are different.  It is recommended not to use values of more
     * than 0.01.
     *
     * @param color1 the first of the two checked colors
     * @param color2 the second of the two checked colors
     * @param margin the test leniency margin
     * @return whether the given colors are considered contrasting, taking the
     * leniency margin into account
     */
    static boolean testContrast(Color color1, Color color2, float margin) {
<span class="nc" id="L144">        float differenceFraction = 1f - margin;</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">        return luminanceDiff(color1, color2) &gt; 125 * differenceFraction</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">                &amp;&amp; colorDiff(color1, color2) &gt; 500 * differenceFraction;</span>
    }

    /**
     * Tests whether the given colors are contrasting colors, according to the
     * test described in the W3C accessibility evaluation working draft
     * {@link &quot;http://www.w3.org/TR/AERT#color-contrast&quot;}.
     *
     * @param color1 the first of the two checked colors
     * @param color2 the second of the two checked colors
     * @return whether the given colors are considered contrasting
     */
    static boolean testContrast(Color color1, Color color2) {
<span class="nc bnc" id="L159" title="All 2 branches missed.">        return luminanceDiff(color1, color2) &gt; 125</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">                &amp;&amp; colorDiff(color1, color2) &gt; 500;</span>
    }

    /**
     * Computes the luminance difference of two colors (a value in range 0-255).
     * It is the luminance value equal to the Y component of the YIQ or the YUV
     * color space models.
     */
    static int luminanceDiff(Color c1, Color c2) {
<span class="nc" id="L169">        return Math.abs(luminance(c1) - luminance(c2));</span>
    }

    /**
     * Computes the luminance value of a color (a value in range 0-255).
     * It is the luminance value equal to the Y component of the YIQ or the YUV
     * color space models.
     */
    static int luminance(Color color) {
<span class="nc" id="L178">        return luminance(color.getRed(), color.getGreen(), color.getBlue());</span>
    }

    /**
     * Computes the luminance value of a color (a value in range 0-255).
     * It is the luminance value equal to the Y component of the YIQ or the YUV
     * color space models.
     */
    static int luminance(int red, int green, int blue) {
<span class="nc" id="L187">        return (red * 299 + green * 587 + blue * 114) / 1000;</span>
    }

    /**
     * Calculates the Manhattan distance of two colors in the RGB color space
     * (a value in range 0-(255*3)).
     */
    static int colorDiff(Color color1, Color color2) {
<span class="nc" id="L195">        return colorDiff(</span>
<span class="nc" id="L196">                color1.getRed(), color1.getGreen(), color1.getBlue(),</span>
<span class="nc" id="L197">                color2.getRed(), color2.getGreen(), color2.getBlue());</span>
    }

    /**
     * Calculates the Manhattan distance of two colors in the RGB color space
     * (a value in range 0-(255*3)).
     */
    static int colorDiff(int r1, int g1, int b1, int r2, int g2, int b2) {
<span class="nc" id="L205">        return Math.abs(r1 - r2) + Math.abs(g1 - g2) + Math.abs(b1 - b2);</span>
    }

    // Utility class, static methods only.
    private ColorUtil() {
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>